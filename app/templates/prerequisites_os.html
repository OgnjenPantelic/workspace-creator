{% extends "base.html" %}

{% block title %}Prerequisites - {{ os_name }} - Databricks Workspace Creator{% endblock %}

{% block content %}
<div class="container">
    <h1>üöÄ Prerequisites for {{ os_name }}</h1>
    <p class="subtitle">Installation instructions and prerequisites for deploying {{ template_name }} on {{ os_name }}.</p>

    {% if cloud == 'aws' %}
    <a href="{{ url_for('aws.os_selection', template_name=template_name) }}" class="back-btn">‚Üê Change Operating System</a>
    {% else %}
    <a href="{{ url_for('azure.os_selection', template_name=template_name) }}" class="back-btn">‚Üê Change Operating System</a>
    {% endif %}

    <div class="prereq-section">
        <div class="prereq-title">What is Terraform?</div>
        <div class="prereq-content">
            <p>Terraform is an infrastructure-as-code tool that allows you to define and deploy cloud resources safely and predictably. This application uses Terraform to deploy your Databricks workspace with all necessary cloud resources.</p>
        </div>
    </div>

    {% if os == 'windows' %}
    <div class="prereq-section">
        <div class="prereq-title">Required Software for Windows</div>
        <div class="prereq-content">
            <div class="step">
                <div class="step-number">1. Install Terraform CLI</div>
                <p>Download Terraform for Windows:</p>
                <div class="code-block">
# Download from: https://www.terraform.io/downloads<br>
# Or use Chocolatey package manager:<br>
choco install terraform
                </div>
                <p>Verify installation:</p>
                <div class="code-block">terraform version</div>
            </div>

            <div class="step">
                <div class="step-number">2. Install Python 3</div>
                <p>Download and install Python from python.org or use Chocolatey:</p>
                <div class="code-block">choco install python</div>
                <p>Verify installation:</p>
                <div class="code-block">python --version</div>
            </div>

            <div class="step">
                {% if cloud == 'aws' %}
                <div class="step-number">3. Install AWS CLI</div>
                <p>Download the AWS CLI MSI installer:</p>
                <div class="code-block">
# Download from: https://aws.amazon.com/cli/<br>
# Or use Chocolatey:<br>
choco install awscli
                </div>
                <p>Configure AWS credentials:</p>
                <div class="code-block">aws configure</div>
                {% else %}
                <div class="step-number">3. Install Azure CLI</div>
                <p>Download the Azure CLI MSI installer:</p>
                <div class="code-block">
# Download from: https://aka.ms/installazurecliwindows<br>
# Or use Chocolatey:<br>
choco install azure-cli
                </div>
                <p>Login to Azure:</p>
                <div class="code-block">az login</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="prereq-section">
        <div class="prereq-title">Running the Local Deployment UI</div>
        <div class="prereq-content">
            <p>After downloading and extracting the template:</p>
            <div class="step">
                <div class="step-number">1. Open PowerShell or Command Prompt</div>
                <p>Navigate to the extracted template directory:</p>
                <div class="code-block">cd path\to\extracted\template</div>
            </div>
            <div class="step">
                <div class="step-number">2. Run the deployment UI</div>
                <div class="code-block">python deploy.py</div>
                <p>The web interface will open at <strong>http://localhost:8080</strong></p>
            </div>
        </div>
    </div>

    {% elif os == 'mac' %}
    <div class="prereq-section">
        <div class="prereq-title">Required Software for macOS</div>
        <div class="prereq-content">
            <div class="step">
                <div class="step-number">1. Install Homebrew (if not already installed)</div>
                <p>Homebrew is a package manager for macOS:</p>
                <div class="code-block">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</div>
            </div>

            <div class="step">
                <div class="step-number">2. Install Terraform CLI</div>
                <p>Use Homebrew to install Terraform:</p>
                <div class="code-block">
brew tap hashicorp/tap<br>
brew install hashicorp/tap/terraform
                </div>
                <p>Verify installation:</p>
                <div class="code-block">terraform version</div>
            </div>

            <div class="step">
                <div class="step-number">3. Install Python 3</div>
                <p>macOS comes with Python, but install the latest version:</p>
                <div class="code-block">brew install python</div>
                <p>Verify installation:</p>
                <div class="code-block">python3 --version</div>
            </div>

            <div class="step">
                {% if cloud == 'aws' %}
                <div class="step-number">4. Install AWS CLI</div>
                <p>Use Homebrew to install AWS CLI:</p>
                <div class="code-block">brew install awscli</div>
                <p>Configure AWS credentials:</p>
                <div class="code-block">aws configure</div>
                {% else %}
                <div class="step-number">4. Install Azure CLI</div>
                <p>Use Homebrew to install Azure CLI:</p>
                <div class="code-block">brew install azure-cli</div>
                <p>Login to Azure:</p>
                <div class="code-block">az login</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="prereq-section">
        <div class="prereq-title">Running the Local Deployment UI</div>
        <div class="prereq-content">
            <p>After downloading and extracting the template:</p>
            <div class="step">
                <div class="step-number">1. Open Terminal</div>
                <p>Navigate to the extracted template directory:</p>
                <div class="code-block">cd ~/Downloads/extracted-template</div>
            </div>
            <div class="step">
                <div class="step-number">2. Run the deployment UI</div>
                <div class="code-block">python3 deploy.py</div>
                <p>The web interface will open at <strong>http://localhost:8080</strong></p>
            </div>
        </div>
    </div>

    {% elif os == 'linux' %}
    <div class="prereq-section">
        <div class="prereq-title">Required Software for Linux</div>
        <div class="prereq-content">
            <div class="step">
                <div class="step-number">1. Install Terraform CLI</div>
                <p>For Ubuntu/Debian:</p>
                <div class="code-block">
wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg<br>
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list<br>
sudo apt update && sudo apt install terraform
                </div>
                <p>For Fedora/RHEL/CentOS:</p>
                <div class="code-block">
sudo dnf install -y dnf-plugins-core<br>
sudo dnf config-manager --add-repo https://rpm.releases.hashicorp.com/fedora/hashicorp.repo<br>
sudo dnf install terraform
                </div>
                <p>Verify installation:</p>
                <div class="code-block">terraform version</div>
            </div>

            <div class="step">
                <div class="step-number">2. Install Python 3</div>
                <p>For Ubuntu/Debian:</p>
                <div class="code-block">sudo apt install python3 python3-pip</div>
                <p>For Fedora/RHEL/CentOS:</p>
                <div class="code-block">sudo dnf install python3 python3-pip</div>
                <p>Verify installation:</p>
                <div class="code-block">python3 --version</div>
            </div>

            <div class="step">
                {% if cloud == 'aws' %}
                <div class="step-number">3. Install AWS CLI</div>
                <p>For Ubuntu/Debian:</p>
                <div class="code-block">
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"<br>
unzip awscliv2.zip<br>
sudo ./aws/install
                </div>
                <p>For Fedora/RHEL/CentOS:</p>
                <div class="code-block">
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"<br>
unzip awscliv2.zip<br>
sudo ./aws/install
                </div>
                <p>Configure AWS credentials:</p>
                <div class="code-block">aws configure</div>
                {% else %}
                <div class="step-number">3. Install Azure CLI</div>
                <p>For Ubuntu/Debian:</p>
                <div class="code-block">
curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash
                </div>
                <p>For Fedora/RHEL/CentOS:</p>
                <div class="code-block">
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc<br>
sudo dnf install azure-cli
                </div>
                <p>Login to Azure:</p>
                <div class="code-block">az login</div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="prereq-section">
        <div class="prereq-title">Running the Local Deployment UI</div>
        <div class="prereq-content">
            <p>After downloading and extracting the template:</p>
            <div class="step">
                <div class="step-number">1. Open Terminal</div>
                <p>Navigate to the extracted template directory:</p>
                <div class="code-block">cd ~/Downloads/extracted-template</div>
            </div>
            <div class="step">
                <div class="step-number">2. Run the deployment UI</div>
                <div class="code-block">python3 deploy.py</div>
                <p>The web interface will open at <strong>http://localhost:8080</strong></p>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="prereq-section">
        <div class="prereq-title">Cloud Provider Access</div>
        <div class="prereq-content">
            {% if cloud == 'aws' %}
            <p>You need appropriate permissions in your AWS account:</p>
            <ul>
                <li><strong>AWS:</strong> IAM permissions to create VPC, subnets, security groups, S3 buckets, and IAM roles</li>
                <li>Permissions to deploy Databricks workspaces (typically requires admin or power user access)</li>
                <li>Access keys configured via <code>aws configure</code></li>
            </ul>
            {% else %}
            <p>You need appropriate permissions in your Azure account:</p>
            <ul>
                <li><strong>Azure:</strong> Contributor or Owner role on the subscription/resource group</li>
                <li>Permissions to create resource groups, virtual networks, and Databricks workspaces</li>
            </ul>
            {% endif %}
        </div>
    </div>

    <div class="prereq-section">
        <div class="prereq-title">Databricks Account Requirements</div>
        <div class="prereq-content">
            <p>You'll need a Databricks account with:</p>
            <ul>
                <li>Account admin privileges to create workspaces</li>
                <li>Account ID (found in your Databricks account console)</li>
                <li>Client ID and Client Secret from a service principal</li>
            </ul>
        </div>
    </div>

    <div class="prereq-section">
        <div class="prereq-title">Download Template</div>
        <div class="prereq-content">
            <p>Once you have all the prerequisites installed, download the Terraform template:</p>
            <div class="text-center" style="margin: 30px 0;">
                {% if cloud == 'aws' %}
                <a href="{{ url_for('aws.download_clean_template', template_name=template_name) }}" class="btn download-btn">üì• Download {{ template_name }} Template</a>
                {% else %}
                <a href="{{ url_for('azure.download_clean_template', template_name=template_name) }}" class="btn download-btn">üì• Download {{ template_name }} Template</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="text-center">
        <a href="{{ url_for('azure.azure_templates') }}" class="back-btn">‚Üê Back to Templates</a>
    </div>
</div>
{% endblock %}
