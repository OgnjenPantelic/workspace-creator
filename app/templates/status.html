{% extends "base.html" %}

{% block title %}Terraform Apply Status{% endblock %}

{% block head %}
<script>
    window.onload = function() {
        var logContainer = document.querySelector('pre');
        if (logContainer) {
            logContainer.scrollTop = logContainer.scrollHeight;
        }
    }
</script>
{% endblock %}

{% block content %}
<div class="container">
    {% if running %}
    <h1>Terraform Apply Running...</h1>
    <p class="loading">Please wait, this may take several minutes.</p>
    <div class="status">
        <pre>{{ output }}</pre>
    </div>
    <a href="{{ url_for('main.index') }}" class="btn">Back to Form</a>
    <meta http-equiv="refresh" content="5">
    {% else %}
    <h1>Terraform Apply Result</h1>
    <div class="status">
        <pre>{{ output }}</pre>
        {% if success %}
        <p class="success">âœ“ Apply successful!</p>
        <div class="download-section">
            <a href="{{ url_for('azure.download_template', template_name=template_name) }}" class="btn download-btn">ðŸ“¥ Download Terraform Code</a>
            <p class="download-note">ðŸ’¡ <strong>Tip:</strong> We suggest uploading this Terraform code to your Git repository and continuing to manage your workspace with it!</p>
        </div>
        {% else %}
        <p class="error">âœ— Apply failed!</p>
        {% endif %}
    </div>
    <a href="{{ url_for('main.index') }}" class="btn">Back to Form</a>
    {% endif %}
</div>
{% endblock %}